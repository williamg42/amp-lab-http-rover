<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="/static/css/controller.css">    

    <img src="/static/img/customLogo.png" alt="AMP Lab Logo">
    <img src="/static/img/ECElogo.png" alt="AMP Lab Logo" align="right">




</head>
<body>


    <div class="footer">
      <p>Created by William Gerhard. <br> For more directions visit https://github.com/williamg42/amp-lab-http-rover</p>
  </div>





  <script>


    var currentxposition= 0;
    var currentyposition= 0;
    var pastxposition= 0;
    var pastyposition= 0;


	  
	  // Get the state of all gamepads
 gamepads = navigator.getGamepads();

for (let i = 0; i < gamepads.length; i++) {
    console.log("Gamepad " + i + ":");

    if (gamepads[i] === null) {
        console.log("[null]");
        continue;
    }

    if (!gamepads[i].connected) {
        console.log("[disconnected]");
        continue;
    }

    console.log("    Index: " + gamepads[i].index);
    console.log("    ID: " + gamepads[i].id);
    console.log("    Axes: " + gamepads[i].axes.length);
    console.log("    Buttons: " + gamepads[i].buttons.length);
    console.log("    Mapping: " + gamepads[i].mapping);
}


    function Senddata() {

        var r = new XMLHttpRequest();
        r.open("GET", "/api/control/drive/" + Math.round(joystick.deltaX()) + "/"+ Math.round(joystick.deltaY()));
        r.send();

    }
      
      
    function GetGPSData() {

        var r = new XMLHttpRequest();
        r.open("GET", "/api/control/GPS/");
        r.send();
     	document.getElementById("GPS").innerHTML = r.response;
        

    }

    function Senddatazero() {

        var r = new XMLHttpRequest();
        r.open("GET", "/api/control/drive/" + (0) + "/" + (0));
        r.send();

    }



   



    setInterval(function(){

     
     gp = gamepads[0];

// Blindly assuming standard mapping
currentxposition = gp.axes[0]);
currentyposition = gp.axes[1]);

console.log("Right stick X: " + currentxposition);
console.log("Right stick Y: " + currentyposition);


     if ((currentxposition == pastxposition) && (currentyposition == pastyposition)) {

        pastyposition = currentyposition
        pastxposition = currentxposition

    } 

    else {

        pastyposition = currentyposition
        pastxposition = currentxposition

        var r = new XMLHttpRequest();
        r.open("GET", "/api/control/drive/" + currentxposition + "/" + currentyposition);
        r.send();


    }

}, 150);
      
 setInterval(GetGPSData, 2000);
</script>

<div id = "imagecontainer">
<img src="http://192.168.3.1:8080/?action=stream" alt="http://192.168.3.1:8080/?action=stream" class="center"  width="640" height="480">
</div>

	<p id="GPS">GPS Data Here!</p>

 <div id="joystickcontainer"> 

  
    <center> <font color="white">Touch and drag inside to control your robot! Tap to stop</font> </div>
</div>
</body>
</html>

