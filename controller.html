<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="/static/css/controller.css">    

    <img src="/static/img/customLogo.png" alt="AMP Lab Logo">
    <img src="/static/img/ECElogo.png" alt="AMP Lab Logo" align="right">




</head>
<body>


    <div class="footer">
      <p>Created by William Gerhard. <br> For more directions visit https://github.com/williamg42/amp-lab-http-rover</p>
  </div>






  <script src="/static/js/virtualjoystick.js"></script>
  <script>
    console.log("touchscreen is", VirtualJoystick.touchScreenAvailable() ? "available" : "not available");

    var currentxposition= 0;
    var currentyposition= 0;
    var pastxposition= 0;
    var pastyposition= 0;

    var joystick = new VirtualJoystick({
      container : document.getElementById('container'),
      mouseSupport: true,
      stationaryBase: false,
      limitStickTravel: true,
      stickRadius: 100
  });


    function Senddata() {

        var r = new XMLHttpRequest();
        r.open("GET", "/api/control/drive/" + Math.round(joystick.deltaX()) + "/"+ Math.round(joystick.deltaY()));
        r.send();

    }
      
      
    function GetGPSData() {

        var r = new XMLHttpRequest();
        r.open("GET", "/api/control/GPS/");
        r.send();
        var body = r.response;
	var element = document.getElementById("GPS");
	element.innerHTML = body;
        

    }

    function Senddatazero() {

        var r = new XMLHttpRequest();
        r.open("GET", "/api/control/drive/" + (0) + "/" + (0));
        r.send();

    }



    joystick.addEventListener('touchEnd', Senddatazero);



    setInterval(function(){

     
     currentxposition = Math.round(joystick.deltaX())
     currentyposition = Math.round(joystick.deltaY())


     if ((currentxposition == pastxposition) && (currentyposition == pastyposition)) {

        pastyposition = currentyposition
        pastxposition = currentxposition

    } 

    else {

        pastyposition = currentyposition
        pastxposition = currentxposition

        var r = new XMLHttpRequest();
        r.open("GET", "/api/control/drive/" + currentxposition + "/" + currentyposition);
        r.send();


    }

}, 150);
      
 setInterval(GetGPSData, 2000);
</script>

<div id = "imagecontainer">
<img src="http://192.168.3.1:8080/?action=stream" alt="http://192.168.3.1:8080/?action=stream" class="center"  width="640" height="480">
</div>
<div id = "GPS">
    

</div>
    
 <div id="joystickcontainer"> 

  
    <center> <font color="white">Touch and drag inside to control your robot! Tap to stop</font> </div>
</div>
</body>
</html>

